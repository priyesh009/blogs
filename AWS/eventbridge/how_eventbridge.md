**EventBridge â€“ How**

**EventBridge**

Amazon EventBridge is a serverless event bus that makes it easy to connect applications together using data from your own applications, integrated Software-as-a-Service (SaaS) applications, and AWS services. EventBridge delivers a stream of real-time data from event sources, such as Zendesk, Datadog, or Pagerduty, and routes that data to targets like AWS Lambda. You can set up routing rules to determine where to send your data to build application architectures that react in real time to all of your data sources.

- **How event bridge works?**

EventBridge connects applications using events. An event is a signal that a system&#39;s state has changed, such as a change in the status of a customer support ticket. To write code to react to events, you need to know the event&#39;s schema, which includes information such as the title, format, and validation rules for each piece of event data. The EventBridge schema registry stores a collection of easy-to-find schema generated by your organization&#39;s applications, AWS services, or SaaS applications. You can also download code bindings for any schema in the registry in your IDE, which enables you to represent the event as an strongly-typed object in your code.

Events are observed, not directed in eventbridge.

I directed command source ask each endpoint (services) to create/ work on the task as mentioned below (source asking the node to create the invoice and once it is completed it will go for the next directed command which is required).

In case of the event bridge event producer announce that the customer has purchased product X all the event consumers (services) observe the event producer announce action and start working on their task. This helps the event producers don&#39;t need to have any knowledge of who is listing this event. This keeps the task simple and allow other services to consume events without needing upstream changes.

![](RackMultipart20211101-4-12lfht4_html_e26527ea86a32ad9.png)

- **Event Bus**

![](RackMultipart20211101-4-12lfht4_html_f87196c3ff4a7083.png)

To perform the distribution of event we need event bus.

This provides an endpoint where event producers send an event that rather manages the directing and filtering the events to the appropriate downstream consumers. Consumers get the events that they care about reliable while others remain decoupled.

The architecture looks like this.

![](RackMultipart20211101-4-12lfht4_html_91a67c1340714a79.png)

Some target care about only certain event and some for all the events.

![](RackMultipart20211101-4-12lfht4_html_a8abe5770ae75c8f.png)

Either way the router now takes on the complexity to ensuring that these events get propagate these events to each downstream services (event consumers).

For other service that need to take action on events we simple need to add them to the bus and they will listen to the events and perform the action instead of waiting for the other service to complete the action and make an update for them.

Types of event we can use.

- **AWS Events**

The AWS EventBridge service is internally built on top of [CloudWatch Events](https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html) which makes it possible to easily react to events generated by other AWS services.

Generally speaking there are 2 different types an EventBridge event can be operated with. The &quot;Schedule&quot; type schedules event emission while the &quot;Pattern&quot; type matches incoming event data based on a configured schema to only invoke the Lambda function when the pattern matches.

Let&#39;s start by looking into the &quot;Schedule&quot; type and define an eventBridge event configuration which invokes our Lambda function every 10 minutes.

In the following serverless.yml file we declare our reminder function which has an eventBridge event source configured to invoke the Lambda function every 10 minutes:

| service: event-bridge
provider:name: awsruntime: nodejs10.x
functions:reminder:handler: handler.helloevents:- eventBridge:schedule: rate(10 minutes) |
| --- |

Scheduling the event delivery in that way makes it possible to create 100% serverless cron services (One can even use [cron expressions](https://en.wikipedia.org/wiki/Cron#CRON_expression) to define when a function should be invoked).

The second, &quot;Pattern&quot; event type gives us great flexibility to react to different events emitted by AWS services such as EC2, Batch, EBS and more. A pattern is basically a schema definition AWS uses to filter out relevant events which are then forwarded to your function.

Let&#39;s imagine that we want to listen to state changes of AWS Key Management Service (KMS). To do that we need to tell AWS that we&#39;re only interested in the KMS service and its event types. The following is a serverless.yml file set up with such configuration:

| service: event-bridge
provider:name: awsruntime: nodejs10.x
functions:kmsNotifier:handler: handler.helloevents:- eventBridge:pattern:source:- aws.kmsdetail-type:- KMS Imported Key Material Expiration- KMS CMK Rotation- KMS CMK Deletion |
| --- |

- **Custom Events**

Using internal AWS event sources is nice since it gives us a great flexibility to react to different changes in our infrastructure. However we&#39;ve learned that this capability was already introduced via [CloudWatch Events](https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html) a while back.

What makes EventBridge even more useful is the support for custom events. But how would that work? Every AWS account is preconfigured with an &quot;AWS internal&quot; event bus called default. This is the bus we&#39;ve just used above when working with internal AWS event sources.

However with the introduction of EventBridge we&#39;re now able to create and configure our own event buses. We can create many different buses for different use cases and / or applications. One could, for example, configure a &quot;marketing&quot; event bus which is solely used for marketing-related event sources and sinks.

Let&#39;s use EventBridge to create our own marketing event bus. Furthermore let&#39;s see how an external Newsletter application can emit events to that bus to invoke a Lambda function responsible for team-wide notifications.

The following serverless.yml definition describes a service which manages the notify function. This function uses the eventBridge event to create a marketing event bus and listens to event sources we define as acme.newsletter.campaign on that event bus:

| service: event-bridge
provider:name: awsruntime: nodejs10.x
functions:notify:handler: handler.helloevents:- eventBridge:eventBus: marketing pattern:source:- acme.newsletter.campaign |
| --- |

Next up we need to add some logic to our Newsletter application so that events are emitted to the marketing event bus everytime something noteworthy happens:

| const AWS = require(&#39;aws-sdk&#39;);
function notifyMarketingTeam(email) {const eventBridge = new AWS.EventBridge({ region: &#39;us-east-1&#39; });
return eventBridge.putEvents({Entries: [{EventBusName: &#39;marketing&#39;,Source: &#39;acme.newsletter.campaign&#39;,DetailType: &#39;UserSignUp&#39;,Detail: `{ &quot;E-Mail&quot;: &quot;${email}&quot; }`,},]}).promise()}
if (userHasSubscribed) {return notifyMarketingTeam(user.email);} |
| --- |

- **Creating a event bridge**

1. Go to the services and search for the Event bridge.

![](RackMultipart20211101-4-12lfht4_html_9ae7edcb5297a2c9.png)

1. Now click on event buses. A panel will open where you can see all you event buses. There you can see there is a default event bus already present even you have never used the event bridge before. You cannot delete the default event bus.

![](RackMultipart20211101-4-12lfht4_html_35991f045df52727.png)

1. Now Click on the rules. Event rules are defined per event bus. In this following case it&#39;s the default event bus.

![](RackMultipart20211101-4-12lfht4_html_ce635365d199d730.png)

1. Click on the Create event rule.

![](RackMultipart20211101-4-12lfht4_html_311ff51a51dd1c93.png)

1. A panel will open you can enter your rule name for this case I am giving the name as myFirstrule.

![](RackMultipart20211101-4-12lfht4_html_c8dbb1034fcbc0fc.png)

1. You can define pattern next. Either we can give it to run according to the time or provide according to cron job or we can use the pattern to connect to any service. For this case we will using pattern to connect to s3 service.

![](RackMultipart20211101-4-12lfht4_html_1e33785467194514.png)

1. Select the event pattern. Than pre-defined pattern by service. In service provide dropdown select AWS. From service name select S3 and event type as all types. On the right hand side you can see the event pattern is build by itself.

![](RackMultipart20211101-4-12lfht4_html_3ffe6a2f78585067.png)

1. Scroll down to select target. In target select cloud watch group and will create new s3 log group with the name eventBridge-s3-log. Than click on create. Now the rule is created.

![](RackMultipart20211101-4-12lfht4_html_1cd0484e0656fad4.png)

1. If you go to the cloud watch log and see the log group is created but its empty.

![](RackMultipart20211101-4-12lfht4_html_a9928e17bcdc5b66.png)

![](RackMultipart20211101-4-12lfht4_html_deeba5d3c897d21e.png)

1. Now I will upload a file in S3 bucket that I already have.

![](RackMultipart20211101-4-12lfht4_html_5baf87ef63eb63ec.png)

1. Now we go back to the cloud watch log we can see a new entry is created inside the log group that we have created.

![](RackMultipart20211101-4-12lfht4_html_e0f4f4c8afbcd33e.png)

1. If you open the logs and cleck the log you can see the action that is performed.

![](RackMultipart20211101-4-12lfht4_html_43c6775ec147b1ab.png)

1. If you check the event pattern and logs together you can get the same pattern in both place.

![](RackMultipart20211101-4-12lfht4_html_7a7cdf41457afa34.png)

1. This is for the all events pattern you can also do the event patter for the object level action like put,delete etc event.

![](RackMultipart20211101-4-12lfht4_html_e7ba03a0480aaa5f.png)

**Conclusion**

EventBridge helps you to integrate multiple Saas services within AWS and help you to perform operations independently without waiting for other services to finish their task even if they are not dependent. It follows observing architecture where event receivers observe the event created by the event creator and perform the action required. In the above post you learned how eventbridge works, in what condition we can use an event bridge and an example of how to create an event and at what levels we can create the events.
